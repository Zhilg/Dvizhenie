ВАЖНО!!!
===========================================================================


**Для правильной работы оболочки с контейнерами разработчиков необходимо поменять поле image в графе back-service в файле docker-compose.yml на имя вашего контейнера. Порт контейнера обязан быть равным 3000.**

**Обязательным условием является работа контейнера без сети интернет.**

Разработчики должны отправлять **один** контейнер, который обрабатывает нижеперечисленные запросы. Если впихнуть все в один контейнер никак не получается, необходимо также отправить полный docker-compose файл с настроенными зависимостями. 

Также к контейнеру/ам и docker-compose файлу необходимо приложить список выполненных задач и скриншоты их выполнения в оболочке.

API Документация 
===========================================================================

Настоящее API определяет функциональность программного модуля семантической обработки данных "ПМ Семантика", далее - ПМ.
ПМ запускается в виде докер-контейнера с монтированием тома для обмена данными.
Обмен производится по HTTP в соответствие с принципами REST с исключением: для обмена файлов большого объёма используется смонтированный том.


Запросы общей гарантированной продолжительностью менее 2 минут выполняются в синхронными режиме.

Запросы возможной продолжительность более 2 минут выполняются в асинхронном режиме. В этом случае задаче присваивается идентификатор, в дальнейшем по этому идентификатору выдаётся статус, после готовности результата вместе со статусом выдается ссылка на результат.


---------------------------------------------------------------------------
1. POST /api/normalize

Описание:

Синхронная нормализация текста:
1. Принимает текст в формате **UTF-8**
2. Выполняет:
   - Удаление лишних пробелов, служебных символов, различных лингвистических конструкций, не имеющих смысловой нагрузки
   - Коррекцию переносов строк
   - Удаление стоп-слов
3. Возвращает нормализованный текст

Запрос:
```
POST /api/normalize HTTP/1.1
content-type: text/plain;

BODY:
Текст в кодировке UTF-8
```

Ответ:
```
HTTP/1.1 200 OK

content-type: text/plain
language: ru (двухбуквенное значение определённого в процессе обработки языка текста в нотации ISO-639-1)

BODY: 
Нормализованный текст в кодировке UTF-8
```
Ошибки:
- 400 INVALID_ENCODING: неподдерживаемая кодировка
- 413 PAYLOAD_TOO_LARGE: текст превышает 10MB
- 429: слишком много запросов
- 5xx - ошибка сервера

---------------------------------------------------------------------------
2. POST /api/embedding

Описание:

Векторизация текста, в синхронном режиме
1. Принимает текст в формате **UTF-8**
2. Выполняет нормализацию текста с использованием метода /normalize
3. Вычисляет векторно-матричную форму нормализованного текста, отображающую смысл выбранного текста. 

Запрос:
```
POST /api/embedding HTTP/1.1
content-type: text/plain;
x-model-id: uuid, идентификатор модели, на основании которого следует векторизовать текст. Применяется модель, полученная из списка /models

BODY: 
Текст в кодировке UTF-8
```

Ответ:
```
HTTP/1.1 200 OK:

{
  "embeddings": [0.123, 0.456, ...], # Значения вектора.
  "dimension": 512, # Размер вектора
}
```
Ошибки:
- 400 INVALID_ENCODING: неподдерживаемая кодировка
- 404: не найдена модель: model_id
- 413 PAYLOAD_TOO_LARGE: текст превышает 10MB
- 429: слишком много запросов
- 5xx - ошибка сервера

---------------------------------------------------------------------------
3. GET /api/models

Описание:

Получить список доступных моделей

Запрос:
```HTTP
GET /api/models HTTP/1.1
```

Ответ:
```:
HTTP/1.1 200 OK:

[ 
  {
    "model_id": "UUID", # идентификатор модели (обязательно)
    "model_name": "bert-multilinguial", # наименование модели (опционально)
    "dimension": "размерность вектора получаемого при эмбеддинге"
  },
  ...
]
```
---------------------------------------------------------------------------
4. POST /api/semantic/upload

Описание:

Асинхронная загрузка корпуса документов (до 100GB).

Применяется для последующего использования корпуса в других запросах.

После загрузки происходит:
1. Чтение иерархии файлов в файловой системе. Возможные типы файлов:
 Текстовые. Формат: txt - кодировка - UTF-8
2. Векторизация документов (По абзацам/документам/любым другим единицам на усмотрение разработчика)

Запрос:
```HTTP
POST /api/semantic/upload HTTP/1.1
content-type: application/json (обязательный)
x-corpus-path: относительный путь к каталогу с файлами. Путь указывается относительно точки монтирования докера ПМ (обязательный). Точка монтирования - папка ~/shared_data. 
x-model-id: - идентификатор модели (обязательный)
x-ttl-hours: - количество часов, по истечении  которых можно удалять производные данные. 0 или не указано - не удалять. (необязательный)
```

Ответ:
```
HTTP/1.1 202 ACCEPTED:

{
  "job_id": "123e4567-e89b-12d3-a456-426614174000", # обязательный
  "estimated_time_min": 120, # необязательный
}
```
Получение статуса обработки
```HTTP
GET /api/jobs/{job_id} HTTP/1.1
```
Статусы обработки:

1. В процессе:
```
HTTP/1.1 200 OK:

{
  "status": "processing", #обязательный
  "progress": 45.2, #необязательный
  "details": { #необязательный
    "bytes_processed": 48318382080,
    "files_processed": 12450
  }
}
```
2. Успешно:
```
HTTP/1.1 200 OK:

{
  "status": "completed",
  "result_url": "http://back-service:3000/<ваш эндпоинт получения результата> // <ваш эндпоинт получения результата>" # ссылка на результат, либо его эндпоинт на стороне разработчика
}
```

Получение результата:
```HTTP
GET /result/url HTTP/1.1
```

Формат результата:
```
HTTP/1.1 200 OK:

{
    "corpus_id": UUID, #созданный идентификатор корпуса
    "file_count": 30000,
    "index_stats": 
    {
      "total_size_gb": 95.4,
    }
}
```
Ошибки:
- 404:
     1. Каталог не найден
     2. Каталог пустой
     3. Модель не найдена
- 5xx: ошибка на сервере

---------------------------------------------------------------------------
5. POST /api/semantic/search

Описание:

Синхронный семантический поиск по **структурированному** корпусу текстовых данных

После вызова происходит:
1. Нормализация поискового запроса с использованием метода /normalize
2. Векторизация запроса с использованием метода /embedding
3. Поиск по корпусу
4. Возврат результата поиска

Запрос:
```
POST /api/semantic/search HTTP/1.1
content-type: text/plain; charset=utf-8 (обязательный)
x-corpus-id: uuid, идентификатор корпуса, загруженного через /semantic/upload (обязательный). Используется то значение, которое вернул контейнер разработчика после выполнения загрузки.
x-result-amount: int, количество возвращаемых результатов поиска
x-model-id: идентификатор модели (обязательный)

BODY: 
текст в кодировке UTF-8
```
Ответ:
```
HTTP/1.1 200 OK:

{
  "results": [ 
    {
      "file_id": "doc123.txt", # Относительный путь до файла внутри корпуса
      "score": 0.87, # Степень смысловой схожести 
      "preview": "...контекстный фрагмент...", # Найденный фрагмент текста, соответствующий запросу
       fragment: 'аннотация или заголовок', # 100 первых символов документа (никакой генерации, просто первые 100 символов найденного документа)
    }, ...
  ] # Массив результатов должен быть отсортирован в порядке убывания score 
}
```

Ошибки:
- 404:
     1. Корпус не найден
     3. Модель не найдена
- 5xx: ошибка на сервере

---------------------------------------------------------------------------
6. POST /api/semantic/search/unstructured

Описание:

Синхронный семантический поиск по **неструктурированному** корпусу текстовых данных

После вызова происходит:
1. Нормализация поискового запроса с использованием метода /normalize
2. Векторизация запроса с использованием метода /embedding
3. Поиск по корпусу
4. Возврат результата поиска

Запрос:
```
POST /api/semantic/search HTTP/1.1
content-type: text/plain; charset=utf-8 (обязательный)
x-corpus-id: uuid, идентификатор корпуса, загруженного через /semantic/upload (обязательный). Используется то значение, которое вернул контейнер разработчика после выполнения загрузки.
x-result-amount: int, количество возвращаемых результатов поиска
x-model-id: идентификатор модели (обязательный)

BODY: 
текст в кодировке UTF-8
```
Ответ:
```
HTTP/1.1 200 OK:

{
  "results": [ 
    {
      "file_id": "doc123.txt", # Относительный путь до файла внутри корпуса
      "score": 0.87, # Степень смысловой схожести 
      "preview": "...контекстный фрагмент...", # 200 символов вокруг найденного фрагмента (Обязательно только в том случае, если разработчик векторизует тексты корпуса по абзацам)
       fragment: 'аннотация или заголовок', # 100 первых символов документа (никакой генерации, просто первые 100 символов найденного документа)
    }, ...
  ] # Массив результатов должен быть отсортирован в порядке убывания score 
}
```

Ошибки:
- 404:
     1. Корпус не найден
     3. Модель не найдена
- 5xx: ошибка на сервере
  
---------------------------------------------------------------------------
7. POST /api/clusterization

Описание:

Асинхронная кластеризация документов
Возможные типы файлов:
Текстовые. Формат: txt - кодировка - UTF-8.

Кластеризации подлежит тот же набор данных, что отдавали в /semantic/upload.

Количество кластеров определяется автоматически.


Запрос:
```
POST /api/clusterization HTTP/1.1
content-type: application/json (обязательный)
x-corpus-id:  uuid, идентификатор корпуса, загруженного через /semantic/upload (обязательный). Используется то значение, которое вернул контейнер разработчика после выполнения загрузки.
x-model-id: идентификатор модели (обязательный)
x-ttl-hours: количество часов, по истечении  которых можно удалять производные данные. 0 или не указано - не удалять. (необязательный)

```

Ответ:
```
HTTP/1.1 202 ACCEPTED:

{
  "job_id": "123e4567-e89b-12d3-a456-426614174000", #обязательный
  "estimated_time_min": 120 #необязательный
}
```

**Получение статуса и результата обработки такое же, как в POST /semantic/upload**

**Формат статуса обработки такой же, как в POST /semantic/upload**

Формат результата:
```
HTTP/1.1 200 OK:

{
  "folder": "C:/documents/text_corpus", # Путь к исходной папке относительно точки монтирования (точка монтирования - папка shared_data)
  "data": {
    "id": "root",                     # Технический корень (все файлы) (не связан с какой-либо файловой структурой, обозначает виртуальную точку входа в данные)
    "name": "Все кластеры",           # Название корневого узла
    "fileCount": 32456,               # Общее число файлов
    "avgSimilarity": 0.82,            # Средняя близость по всем файлам
    "children": [                     # Список ОСНОВНЫХ кластеров 1-го уровня (основные кластеры -- это самые крупные группы документов, на которые разбивается вся коллекция файлов. Они находятся непосредственно под корневым узлом ("id": "root").)
      {
        "id": "cluster1",
        "name": "Технологии",         # Название кластера, осмысленное название не обязательно, разрешается возвращать нумерацию
        "fileCount": 12480,            # Количество файлов в этом кластере
        "avgSimilarity": 0.87,         # Средняя близость внутри кластера
        "similarityDistribution": [0, 0.1, 0.2, 0.3, 0.4] # Массив из 5 чисел, где каждый элемент представляет долю (от 0.0 до 1.0) файлов в кластере, чья схожесть с центроидом попадает в один из интервалов: [0.0, 0.2), [0.2, 0.4), [0.4, 0.6), [0.6, 0.8), [0.8, 1.0]
                                                          # Массив [0, 0.1, 0.2, 0.3, 0.4] означает, что 0% файлов в кластере имеют долю схожести, лежащую в промежутке [0.0, 0.2), 10% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.2, 0.4), 20% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.4, 0.6), 
                                                          # 30% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.6, 0.8) и 40% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.8, 1]
        "files": [
          {
            "name": "ai_research.txt", # Имя файла, один и тот же файл может находиться в разных кластерах
          }, ...
        ],               # Файлы, напрямую входящие в этот кластер
        "children": [...]             # ПОДкластеры (например, "ИИ" внутри "Технологий"), структура такая же. Представляют собой разбиение основных кластеров на темы, могут также иметь неограниченное число детей.
      },
      {
        "id": "cluster2",
        "name": "Наука",
        ...                           # Аналогичная структура
      },
      ...
    ]
  }
   "graphic_respresentation": null/"url_сервиса_визуализации" # Разработчик отправляет ссылку на свой сервис отображения результатов кластеризации посредством их визуализации с помощью построения графики, необходимой и достаточной для наглядного объяснения получившихся результатов. Является отдельной задачей, в случае, если она не сделана, разрешается отправлять null.
   "planetar_representation": null/"url_сервиса_визуализации" # Аналогично полю "graphic_respresentation" за исключением того, что должна использоваться планетарная модель (2D или 3D).
   "drill-down_representation": null/"url_сервиса_визуализации" # Аналогично полю "graphic_respresentation" за исключением того, что должна использоваться drill-down модель.

}
```
Ошибки:
- 404: не найден каталог для обработки или каталог пустой
- 5xx: ошибка на сервере

---------------------------------------------------------------------------
8. POST /api/classification

Описание:

Асинхронная классификация документов
Возможные типы файлов:
Текстовые. Формат: txt - кодировка - UTF-8.

Классификации подлежит контрольный набор данных.

После вызова происходит:
1. Чтение иерархии файлов в файловой системе. Возможные типы файлов:
 Текстовые. Формат: txt - кодировка - UTF-8
2. Классификация всех текстов на предмет соответствия классам, выявленным по результатам кластеризации (далее -- новым классам).
3. Возврат в Оболочку тех же данных, что и при решении задач /clusterisation. Плюс таблицу соответствия с указанием для каждого тестового файла номер/наименований соответствующих ему новых классов и степени соответствия этим новым классам.

Запрос:
```
POST /api/classification HTTP/1.1
content-type: application/json (обязательный)
x-corpus-path: относительный путь к каталогу с файлами. Путь указывается относительно точки монтирования докера ПМ (обязательный). Точка монтирования - папка shared_data
x-model-id: идентификатор модели (обязательный)
x-clustering-job-id: 123e4567-e89b-12d3-a456-426614174000  // ← НОВЫЙ параметр! ID решения задач 5-7, на основании которого будет проводиться классификация (обязательный).
x-ttl-hours: количество часов, по истечении  которых можно удалять производные данные. 0 или не указано - не удалять. (необязательный)
```

Ответ:
```
HTTP/1.1 202 ACCEPTED:

{
  "job_id": "123e4567-e89b-12d3-a456-426614174000", #обязательный
  "estimated_time_min": 120 #необязательный
}
```

Получение статуса обработки
```HTTP
GET /api/jobs/{job_id} HTTP/1.1
```
Статусы обработки:

1. В процессе:
```
HTTP/1.1 200 OK:

{
  "status": "processing", #обязательный
  "progress": 45.2, #необязательный
  "details": { #необязательный
    "bytes_processed": 48318382080,
    "files_processed": 12450
  }
}
```

2. Успешно:
```
HTTP/1.1 200 OK:

{
  "status": "completed",
  "result_url": "http:///" # ссылка на результат"
}
```

Получение результата:
```HTTP
GET /result/url HTTP/1.1
```

Формат результата:
```
HTTP/1.1 200 OK:

{
  "folder": "C:/documents/text_corpus", # Путь к исходной папке относительно точки монтирования (точка монтирования - папка shared_data)
  "data": { # Результаты классификации новых файлов по кластерам, полученным ранее.
    "id": "root",                     # Технический корень (все файлы) (не связан с какой-либо файловой структурой, обозначает виртуальную точку входа в данные)
    "name": "Все кластеры",           # Название корневого узла
    "fileCount": 32456,               # Общее число файлов
    "avgSimilarity": 0.82,            # Средняя близость по всем файлам
    "children": [                     # Список ОСНОВНЫХ кластеров 1-го уровня (основные кластеры -- это самые крупные группы документов, на которые разбивается вся коллекция файлов. Они находятся непосредственно под корневым узлом ("id": "root").)
      {
        "id": "cluster1",
        "name": "Технологии",         # Название кластера, осмысленное название не обязательно, разрешается возвращать нумерацию
        "fileCount": 12480,            # Количество файлов в этом кластере
        "avgSimilarity": 0.87,         # Средняя близость внутри кластера
        "similarityDistribution": [0, 0.1, 0.2, 0.3, 0.4] # Массив из 5 чисел, где каждый элемент представляет долю (от 0.0 до 1.0) файлов в кластере, чья схожесть с центроидом попадает в один из интервалов: [0.0, 0.2), [0.2, 0.4), [0.4, 0.6), [0.6, 0.8), [0.8, 1.0]
                                                          # Массив [0, 0.1, 0.2, 0.3, 0.4] означает, что 0% файлов в кластере имеют долю схожести, лежащую в промежутке [0.0, 0.2), 10% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.2, 0.4), 20% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.4, 0.6), 
                                                          # 30% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.6, 0.8) и 40% файлов в кластеере имеют долю схожести, лежащую в промежутке [0.8, 1]
        "files": [
          {
            "name": "ai_research.txt", # Имя файла, один и тот же файл может находиться в разных кластерах
          }, ...
        ],               # Файлы, напрямую входящие в этот кластер
        "children": [...]             # ПОДкластеры (например, "ИИ" внутри "Технологий"), структура такая же. Представляют собой разбиение основных кластеров на темы, могут также иметь неограниченное число детей.
      },
      {
        "id": "cluster2",
        "name": "Наука",
        ...                           # Аналогичная структура
      },
      ...
    ]
  }
   "correspondence_table": { # Таблица соответствия 
    "files": [
      {
        "f": "file001.txt", # Имя файла
        "d": [ # Указание для каждого тестового файла номер/наименований соответствующих ему кластеров и степени соответствия этим кластерам. (Требуется возврат 5 наиболее близких по расчетам разработчика кластеров.)
          ["c1", 0.92], # [ID кластера, степень соответствия этому кластеру]
          ["c3", 0.85],
          ["c5", 0.78],
          ["c7", 0.72],
          ["c9", 0.68]
        ]
      },
      {
        "f": "file002.txt",
        "d": [
          ["c2", 0.91],
          ["c4", 0.83],
          ["c6", 0.75],
          ["c8", 0.69],
          ["c10", 0.64]
        ]
      }
    ],
    "cluster_names": { # Таблица сокращенных именований кластеров, необходима только в случае если кластерам присваивается имя, а не номер.
      "c1": "Технологии",
      "c2": "Наука",
      "c3": "Искусство",
      "c4": "Спорт",
      "c5": "Политика",
      "c6": "Экономика",
      "c7": "Здоровье",
      "c8": "Образование",
      "c9": "Путешествия",
      "c10": "Еда"
    }
  },
   "graphic_respresentation": null/"url_сервиса_визуализации" # Разработчик отправляет ссылку на свой сервис отображения результатов кластеризации посредством их визуализации с помощью построения графики, необходимой и достаточной для наглядного объяснения получившихся результатов. Является отдельной задачей, в случае, если она не сделана, разрешается отправлять null.
   
}
```
Ошибки:
- 404:
     1. Каталог не найден
     2. Каталог пустой
     3. Модель не найдена
     4. Результаты сделанной ранее классификации не найдены
- 5xx: ошибка на сервере


---------------------------------------------------------------------------
8. POST /api/classification/grnti

Описание:

Асинхронная классификация документов
Возможные типы файлов:
Текстовые. Формат: txt - кодировка - UTF-8.

Классификации подлежит контрольный набор данных.

После вызова происходит:
1. Чтение иерархии файлов в файловой системе. Возможные типы файлов:
 Текстовые. Формат: txt - кодировка - UTF-8
2. Классификация всех текстов на предмет соответствия классам, выявленным по результатам кластеризации (далее -- новым классам).
3. Возврат в Оболочку тех же данных, что и при решении задач /clusterisation. Плюс таблицу соответствия с указанием для каждого тестового файла номер/наименований соответствующих ему новых классов и степени соответствия этим новым классам.

Запрос:
```
POST /api/classification/grnti HTTP/1.1
content-type: application/json (обязательный)
x-corpus-path: относительный путь к каталогу с файлами. Путь указывается относительно точки монтирования докера ПМ (обязательный). Точка монтирования - папка shared_data
x-model-id: идентификатор модели (обязательный)
x-clustering-job-id: 123e4567-e89b-12d3-a456-426614174000  // ← НОВЫЙ параметр! ID решения задач 5-7, на основании которого будет проводиться классификация (обязательный).
x-ttl-hours: количество часов, по истечении  которых можно удалять производные данные. 0 или не указано - не удалять. (необязательный)
```

Ответ:
```
HTTP/1.1 202 ACCEPTED:

{
  "job_id": "123e4567-e89b-12d3-a456-426614174000", #обязательный
  "estimated_time_min": 120 #необязательный
}
```

Получение статуса обработки
```HTTP
GET /api/jobs/{job_id} HTTP/1.1
```
Статусы обработки:

1. В процессе:
```
HTTP/1.1 200 OK:

{
  "status": "processing", #обязательный
  "progress": 45.2, #необязательный
  "details": { #необязательный
    "bytes_processed": 48318382080,
    "files_processed": 12450
  }
}
```

2. Успешно:
```
HTTP/1.1 200 OK:

{
  "status": "completed",
  "result_url": "http:///" # ссылка на результат"
}
```

Получение результата:
```HTTP
GET /result/url HTTP/1.1
```

Формат результата:
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "folder": "/test_corpus/control_set",
  "model_id": "model_military_affairs_v3",
  "grnti_branch": "военное дело",
  "classification_results": {
    "summary": {
      "total_files": 1000,
      "files_classified": 1000,
      "agreement_with_expert": 0.87,
      "accuracy_top_3": 0.95
    },
    "detailed_stats": {
      "76.01.00": {
        "code": "76.01.00",
        "name": "Общие вопросы военной науки и техники",
        "expert_count": 150,
        "system_count": 145,
        "true_positive": 142,
        "false_positive": 3,
        "false_negative": 8,
        "precision": 0.979,
        "recall": 0.947
      },
      "76.03.00": {
        "code": "76.03.00",
        "name": "Военное искусство",
        "expert_count": 220,
        "system_count": 215,
        "true_positive": 210,
        "false_positive": 5,
        "false_negative": 10,
        "precision": 0.977,
        "recall": 0.955
      }
    }
  },
  "files": [
    {
      "file": "document_0012.txt",
      "expert_grnti_code": "76.03.01",
      "expert_grnti_name": "Стратегия и оперативное искусство",
      "predicted_grnti_code": "76.03.01",
      "predicted_grnti_name": "Стратегия и оперативное искусство",
      "similarity": 0.94,
      "top_5_predictions": [
        ["76.03.01", 0.94],
        ["76.03.03", 0.12],
        ["76.01.07", 0.08],
        ["76.05.01", 0.05],
        ["76.29.05", 0.02]
      ]
    },
    {
      "file": "document_0457.txt",
      "expert_grnti_code": "76.01.07",
      "expert_grnti_name": "Системный анализ, управление и обработка информации в военном деле",
      "predicted_grnti_code": "76.29.05", // Система ошиблась
      "predicted_grnti_name": "Авиационное вооружение",
      "similarity": 0.89,
      "top_5_predictions": [
        ["76.29.05", 0.89], // Ложноположительное срабатывание
        ["76.01.07", 0.85], // Правильный код был на 2-м месте
        ["76.03.03", 0.07],
        ["76.15.11", 0.04],
        ["76.17.01", 0.03]
      ]
    }
  ],
  "confusion_matrix_url": "/api/grnti-classification/results/987e6543.../confusion_matrix.png",
  "report_url": "/api/grnti-classification/results/987e6543.../detailed_report.pdf"
}
```
Ошибки:
- 404:
     1. Каталог не найден
     2. Каталог пустой
     3. Модель не найдена
     4. Результаты сделанной ранее классификации не найдены
- 5xx: ошибка на сервере

---------------------------------------------------------------------------
9. POST /api/evaluation/precision

Описание:

Синхронное обеспечение точности смысловой схожести текстов (фрагментов) в поисковом отклике с текстом поискового запроса не ниже 0.8.

Отрабатывает по результатам выполнения задач classification и classification/grnti. Классификации подлежит контрольный набор данных.

После вызова происходит автоматический расчет значений статусов TP, FP и FN для каждого тестового файла. Численное значение каждого из статусов суммируется по всей тысяче строк тестовых файлов и на основании суммарных значений статусов вычисляется среднее значение точности (precision) по формуле TP / (TP + FP).


Запрос:
```HTTP
POST /api/evaluation/precision HTTP/1.1

Content-Type: application/json
x-classification-job-id: 123e4567-e89b-12d3-a456-426614174000 # ID решения задачи 11/12
x-evaluation-type: cluster|grnti  # тип классификации: cluster (Задача 11) или grnti (Задача 12)
```

Ответ:
```HTTP
HTTP/1.1 200 OK
Content-Type: application/json

{
  "evaluation_type": "precision",
  "classification_type": "cluster",  # или "grnti"
  "classification_job_id": "123e4567-e89b-12d3-a456-426614174000",
  "threshold": 0.8,
  "metrics": {
    "total_files": 1000,
    "total_tp": 870,
    "total_fp": 130,
    "total_fn": 130,
    "precision": 0.87,
    "threshold_met": true
  },
  "file_level_metrics": [
    {
      "file": "document_0012.txt",
      "expert_label": "cluster1",
      "system_predictions": [
        ["cluster1", 0.92],
        ["cluster3", 0.85],
        ["cluster5", 0.78],
        ["cluster7", 0.72],
        ["cluster9", 0.68]
      ],
      "tp": 1,
      "fp": 4,
      "fn": 4,
      "precision": 0.2,
      "match_found": true
    },
    {
      "file": "document_0457.txt",
      "expert_label": "cluster2",
      "system_predictions": [
        ["cluster1", 0.91],
        ["cluster4", 0.83],
        ["cluster6", 0.75],
        ["cluster8", 0.69],
        ["cluster10", 0.64]
      ],
      "tp": 0,
      "fp": 5,
      "fn": 5,
      "precision": 0.0,
      "match_found": false
    }
  ],
  "summary": {
    "files_with_matches": 870,
    "files_without_matches": 130,
    "average_precision": 0.87,
    "requirement_met": true
  }
}
```

Ошибки:
- 400:
   1. Неверные параметры
   2. Задание не завершено
- 404:
     1. Задание не найдено
- 5xx: ошибка на сервере


---------------------------------------------------------------------------
POST /api/evaluation/recall
Описание:

Синхронное обеспечение полноты поискового отклика не ниже 0.8.

Отрабатывает по результатам выполнения задач classification и classification/grnti. Классификации подлежит контрольный набор данных.

После вызова происходит автоматический расчет значений статусов TP, FP и FN для каждого тестового файла. Численное значение каждого из статусов суммируется по всей тысяче строк тестовых файлов и на основании суммарных значений статусов вычисляется среднее значение полноты (recall) по формуле TP / (TP + FN).

Запрос:
```HTTP
POST /api/evaluation/recall HTTP/1.1

Content-Type: application/json
x-classification-job-id: 123e4567-e89b-12d3-a456-426614174000 # ID решения задачи 11/12
x-evaluation-type: cluster|grnti  # тип классификации: cluster (Задача 11) или grnti (Задача 12)
```

Ответ:

```HTTP
HTTP/1.1 200 OK
Content-Type: application/json

{
  "evaluation_type": "recall",
  "classification_type": "cluster",  # или "grnti"
  "classification_job_id": "123e4567-e89b-12d3-a456-426614174000",
  "threshold": 0.8,
  "metrics": {
    "total_files": 1000,
    "total_tp": 850,
    "total_fp": 150,
    "total_fn": 150,
    "recall": 0.85,  # TP / (TP + FN)
    "threshold_met": true
  },
  "file_level_metrics": [
    {
      "file": "document_0012.txt",
      "expert_label": "cluster1",
      "system_predictions": [
        ["cluster1", 0.92],
        ["cluster3", 0.85],
        ["cluster5", 0.78],
        ["cluster7", 0.72],
        ["cluster9", 0.68]
      ],
      "tp": 1,
      "fp": 4,
      "fn": 4,
      "recall": 0.2,  # TP / (TP + FN)
      "match_found": true
    },
    {
      "file": "document_0457.txt",
      "expert_label": "cluster2",
      "system_predictions": [
        ["cluster1", 0.91],
        ["cluster4", 0.83],
        ["cluster6", 0.75],
        ["cluster8", 0.69],
        ["cluster10", 0.64]
      ],
      "tp": 0,
      "fp": 5,
      "fn": 5,
      "recall": 0.0,
      "match_found": false
    }
  ],
  "summary": {
    "files_with_matches": 850,
    "files_without_matches": 150,
    "average_recall": 0.85,
    "requirement_met": true
  }
}
```

Ошибки:
- 400:
   1. Неверные параметры
   2. Задание не завершено
- 404:
     1. Задание не найдено
- 5xx: ошибка на сервере

